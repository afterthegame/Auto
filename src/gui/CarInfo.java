/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package gui;

import auto.InputDataController;
import java.util.ArrayList;
import javax.swing.JOptionPane;

/**
 *
 * @author gorz
 */
public class CarInfo extends javax.swing.JFrame implements Clearable {

    private GuiController controller;
    private InputDataController inputDataController;
    
    /**
     * Creates new form CarInfo
     */
    public CarInfo(GuiController controller, InputDataController inputDataController) {
        initComponents();
        this.controller = controller;
        this.inputDataController = inputDataController;
        ArrayList<String> brands = inputDataController.getBrands();
        brand.removeAllItems();
        for(String n : brands) {
            brand.addItem(n);
        }
        brand.setSelectedIndex(0);
        ArrayList<String> bodies = inputDataController.getBodies();
        body.removeAllItems();
        for(String n : bodies) {
            body.addItem(n);
        }
        body.setSelectedIndex(0);
        back.addKeyListener(GuiController.listener);
        next.addKeyListener(GuiController.listener);
        this.setLocationRelativeTo(null);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        title = new javax.swing.JLabel();
        brandLabel = new javax.swing.JLabel();
        modelLabel = new javax.swing.JLabel();
        brand = new javax.swing.JComboBox();
        model = new javax.swing.JComboBox();
        yearLabel = new javax.swing.JLabel();
        volumeLabel = new javax.swing.JLabel();
        year = new javax.swing.JTextField();
        volume = new javax.swing.JTextField();
        bodyLabel = new javax.swing.JLabel();
        body = new javax.swing.JComboBox();
        back = new javax.swing.JButton();
        next = new javax.swing.JButton();
        taxLabel = new javax.swing.JLabel();
        tax = new javax.swing.JTextField();
        regionLabel = new javax.swing.JLabel();
        region = new javax.swing.JComboBox();
        massLabel = new javax.swing.JLabel();
        mass = new javax.swing.JTextField();
        mileageLable = new javax.swing.JLabel();
        mileage = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        title.setText("Информация о машине");

        brandLabel.setText("Марка:");

        modelLabel.setText("Модель:");

        brand.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                brandItemStateChanged(evt);
            }
        });

        yearLabel.setText("Год выпуска:");

        volumeLabel.setText("Объем двигателя (л. куб.):");

        year.setText("2010");

        bodyLabel.setText("Тип кузова:");

        back.setText("Назад");
        back.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                backActionPerformed(evt);
            }
        });

        next.setText("Продолжить");
        next.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                nextActionPerformed(evt);
            }
        });

        taxLabel.setText("Сумма налога:");

        regionLabel.setText("Регион:");

        region.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Регионы с низким инвестиционным интересом", "Регионы с выскоим инвестиционным интересом", "Другие районы" }));

        massLabel.setText("Масса (в тоннах):");

        mass.setText("2.8");

        mileageLable.setText("Пробег (тыс. км.):");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(region, javax.swing.GroupLayout.Alignment.TRAILING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(taxLabel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(tax, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(back)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(next))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(brand, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED))
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(brandLabel, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                                        .addComponent(yearLabel)
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                        .addComponent(year, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addGap(43, 43, 43)))
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(volumeLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 140, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(volume))
                            .addComponent(modelLabel)
                            .addComponent(model, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(regionLabel)
                            .addComponent(bodyLabel)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(massLabel)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(mass, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(28, 28, 28)
                                .addComponent(mileageLable)
                                .addGap(8, 8, 8)
                                .addComponent(mileage, javax.swing.GroupLayout.PREFERRED_SIZE, 89, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(body, javax.swing.GroupLayout.PREFERRED_SIZE, 191, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGap(150, 150, 150)
                .addComponent(title)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(title)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(brandLabel)
                    .addComponent(modelLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(brand, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(model, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(year, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(volumeLabel)
                    .addComponent(yearLabel)
                    .addComponent(volume, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(bodyLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(body, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(mass, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(massLabel)
                    .addComponent(mileageLable)
                    .addComponent(mileage, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(regionLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(region, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(back)
                    .addComponent(next)
                    .addComponent(taxLabel)
                    .addComponent(tax, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void backActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_backActionPerformed
        controller.changeFrame("driverInfo");
    }//GEN-LAST:event_backActionPerformed
    
    @Override
    public void clear() {
        brand.setSelectedIndex(0);
        body.setSelectedIndex(0);
        volume.setText("");
        year.setText("");
        body.setSelectedIndex(0);
        mass.setText("");
        mileage.setText("");
        region.setSelectedIndex(0);
        tax.setText("0");
    }
    
    private void brandItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_brandItemStateChanged
        ArrayList<String> models = inputDataController.getModels(brand.getSelectedIndex());
        model.removeAllItems();
        if(models == null) {
            JOptionPane.showMessageDialog(this, "Сбой БД!");
            return;
        }
        for(String n : models) {
            model.addItem(n);
        }
    }//GEN-LAST:event_brandItemStateChanged

    private void nextActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_nextActionPerformed
        int yearVal;
        float volumeVal, taxVal, massVal, mileageVal;
        try {
            yearVal = Integer.valueOf(year.getText());
        } catch(NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Значение 'Год выпуска' должно быть целым числом!");
            return;
        }
        if(yearVal < 1950) {
            JOptionPane.showMessageDialog(this, "Значение 'Год выпуска' должно быть больше 1950!");
            return;
        }
        try {
            volumeVal = Float.valueOf(volume.getText());
        } catch(NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Значение 'Объем двигателя' должно быть числом!");
            return;
        }
        if(volumeVal <= 0) {
            JOptionPane.showMessageDialog(this, "Значение 'Объем двигателя' должно быть положительным!");
            return;
        }
        try {
            taxVal = Float.valueOf(tax.getText());
        } catch(NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Значение 'Сумма налога' должно быть числом!");
            return;
        }
        try {
            massVal = Float.valueOf(mass.getText());
        } catch(NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Значение 'Масса' должно быть числом!");
            return;
        }
        if(massVal <= 0) {
            JOptionPane.showMessageDialog(this, "Значение 'Масса' должно быть положительным!");
            return;
        }
        try {
            mileageVal = Float.valueOf(mileage.getText());
        } catch(NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Значение 'Пробег' должно быть числом!");
            return;
        }
        if(mileageVal < 0) {
            JOptionPane.showMessageDialog(this, "Значение 'Пробег' должно быть положительным!");
            return;
        }
        inputDataController.setCarInfo(
                    brand.getSelectedIndex(),
                    model.getSelectedIndex(),
                    body.getSelectedIndex(),
                    yearVal,
                    volumeVal,
                    region.getSelectedIndex(),
                    taxVal,
                    massVal,
                    mileageVal
                );
        controller.changeFrame("usageConditions");
    }//GEN-LAST:event_nextActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton back;
    private javax.swing.JComboBox body;
    private javax.swing.JLabel bodyLabel;
    private javax.swing.JComboBox brand;
    private javax.swing.JLabel brandLabel;
    private javax.swing.JTextField mass;
    private javax.swing.JLabel massLabel;
    private javax.swing.JTextField mileage;
    private javax.swing.JLabel mileageLable;
    private javax.swing.JComboBox model;
    private javax.swing.JLabel modelLabel;
    private javax.swing.JButton next;
    private javax.swing.JComboBox region;
    private javax.swing.JLabel regionLabel;
    private javax.swing.JTextField tax;
    private javax.swing.JLabel taxLabel;
    private javax.swing.JLabel title;
    private javax.swing.JTextField volume;
    private javax.swing.JLabel volumeLabel;
    private javax.swing.JTextField year;
    private javax.swing.JLabel yearLabel;
    // End of variables declaration//GEN-END:variables
}
